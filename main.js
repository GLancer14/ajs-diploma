/*! For license information please see main.js.LICENSE.txt */
!function(){"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,r(o.key),o)}}function r(t){var r=function(t){if("object"!=e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!=e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}var n=function(){return e=function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"Character"===(this instanceof e?this.constructor:void 0).name)throw new Error("Персонаж должен создаваться из дочернего класса!");this.level=t.level,this.attack=t.attack||0,this.defence=t.defence||0,this.health=50,this.type="generic"},(r=[{key:"upgradeCharacter",value:function(e){for(var t=0;t<e;t++)this.level+=1,this.health=this.health<20?this.health+80:100,this.attack=Math.max(this.attack,Math.round(this.attack*(20+this.health)/100)),this.defence=Math.max(this.defence,Math.round(this.defence*(10+this.health)/100))}}])&&t(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r}();function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function i(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}var l=i(function e(t,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof n))throw new Error("character must be instance of Character or its children");if("number"!=typeof r)throw new Error("position must be a number");this.character=t,this.position=r});function s(e,t){var r=Math.pow(t,2);return 0===e?"top-left":e===t-1?"top-right":e===r-t?"bottom-left":e===r-1?"bottom-right":e<t-1?"top":e%t===0?"left":(e+1)%t===0?"right":e<r&&e>r-t?"bottom":"center"}function u(e){return e<15?"critical":e<50?"normal":"high"}function f(e,t,r){var n=Math.pow(r,2),o=[];if("player"===e)for(var a=0;a<n;a++)0!==a&&a%r!==0&&(a-1)%r!=0||o.push(a);else for(var i=0;i<n;i++)(i+1)%r!==0&&(i+2)%r!==0||o.push(i);return t.map(function(e){var t=Math.floor(Math.random()*o.length),r=o[t];return o.splice(t,1),new l(e,r)})}function h(e,t){var r=e.row,n=e.column,o=t.row,a=t.column;return Number(Math.sqrt(Math.pow(o-r,2)+Math.pow(a-n,2)).toFixed(2))}function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function p(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=d(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){c=!0,a=e},f:function(){try{i||null==r.return||r.return()}finally{if(c)throw a}}}}function d(e,t){if(e){if("string"==typeof e)return m(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,b(n.key),n)}}function b(e){var t=function(e){if("object"!=y(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==y(t)?t:t+""}var g=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListener=null,this.saveGameListener=null,this.loadGameListener=null},t=[{key:"bindToDOM",value:function(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}},{key:"drawUi",value:function(e){var t=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="scores-wrapper">\n        <span class="high-scores-desc">High scores:</span>\n        <span class="high-scores">0</span>\n        <span class="current-scores-desc">Current scores:</span>\n        <span class="current-scores">0</span>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",function(e){return t.onNewGameClick(e)}),this.saveGameEl.addEventListener("click",function(e){return t.onSaveGameClick(e)}),this.loadGameEl.addEventListener("click",function(e){return t.onLoadGameClick(e)}),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(e);for(var r=0;r<Math.pow(this.boardSize,2);r+=1){var n=document.createElement("div");n.classList.add("cell","map-tile","map-tile-".concat(s(r,this.boardSize))),n.addEventListener("mouseenter",function(e){return t.onCellEnter(e)}),n.addEventListener("mouseleave",function(e){return t.onCellLeave(e)}),n.addEventListener("click",function(e){return t.onCellClick(e)}),this.boardEl.appendChild(n)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(e){var t,r=p(this.cells);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.innerHTML="",n.title=""}}catch(e){r.e(e)}finally{r.f()}var o,a=p(e);try{for(a.s();!(o=a.n()).done;){var i=o.value,c=this.boardEl.children[i.position],l=document.createElement("div");l.classList.add("character",i.character.type);var s=document.createElement("div");s.classList.add("health-level");var f=document.createElement("div"),h=u(i.character.health);f.classList.add("health-level-indicator","health-level-indicator-".concat(h)),f.style.width="".concat(i.character.health,"%"),s.appendChild(f),l.appendChild(s),c.appendChild(l)}}catch(e){a.e(e)}finally{a.f()}}},{key:"addCellEnterListener",value:function(e){this.cellEnterListeners.push(e)}},{key:"addCellLeaveListener",value:function(e){this.cellLeaveListeners.push(e)}},{key:"addCellClickListener",value:function(e){this.cellClickListeners.push(e)}},{key:"addNewGameListener",value:function(e){this.newGameListener=e}},{key:"addSaveGameListener",value:function(e){this.saveGameListener=e}},{key:"addLoadGameListener",value:function(e){this.loadGameListener=e}},{key:"onCellEnter",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners[t].call(null,t)}},{key:"onCellLeave",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners[t].call(null,t)}},{key:"onCellClick",value:function(e){var t=this.cells.indexOf(e.currentTarget);this.cellClickListeners[t].call(null,t)}},{key:"onNewGameClick",value:function(e){e.preventDefault(),this.newGameListener.call(null)}},{key:"onSaveGameClick",value:function(e){e.preventDefault(),this.saveGameListener.call(null)}},{key:"onLoadGameClick",value:function(e){e.preventDefault(),this.loadGameListener.call(null)}},{key:"selectCell",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(e),this.cells[e].classList.add("selected","selected-".concat(t))}},{key:"deselectCell",value:function(e){var t,r=this.cells[e];(t=r.classList).remove.apply(t,function(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||d(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Array.from(r.classList).filter(function(e){return e.startsWith("selected")})))}},{key:"showCellTooltip",value:function(e,t){this.cells[t].title=e}},{key:"hideCellTooltip",value:function(e){this.cells[e].title=""}},{key:"showDamage",value:function(e,t){var r=this;return new Promise(function(n){var o=r.cells[e],a=document.createElement("span");a.textContent=t,a.classList.add("damage"),o.appendChild(a),a.addEventListener("animationend",function(){o.removeChild(a),n()})})}},{key:"setCursor",value:function(e){this.boardEl.style.cursor=e}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}],r=[{key:"showError",value:function(e){alert(e)}},{key:"showMessage",value:function(e){alert(e)}}],t&&v(e.prototype,t),r&&v(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}(),S=["prairie","desert","arctic","mountain"];function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,k(n.key),n)}}function P(e,t,r){return t&&C(e.prototype,t),r&&C(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function k(e){var t=function(e){if("object"!=w(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==w(t)?t:t+""}var O=P(function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.characters=t});function j(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,s=Object.create(l.prototype);return T(s,"_invoke",function(r,n,o){var a,c,l,s=0,u=o||[],f=!1,h={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return a=t,c=0,l=e,h.n=r,i}};function y(r,n){for(c=r,l=n,t=0;!f&&s&&!o&&t<u.length;t++){var o,a=u[t],y=h.p,p=a[2];r>3?(o=p===n)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=y&&((o=r<2&&y<a[1])?(c=0,h.v=n,h.n=a[1]):y<p&&(o=r<3||a[0]>n||n>p)&&(a[4]=r,a[5]=n,h.n=p,c=0))}if(o||r>1)return i;throw f=!0,n}return function(o,u,p){if(s>1)throw TypeError("Generator is already running");for(f&&1===u&&y(u,p),c=u,l=p;(t=c<2?e:l)||!f;){a||(c?c<3?(c>1&&(h.n=-1),y(c,l)):h.n=l:h.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=h.n<0)?l:r.call(n,h))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:f}}}(r,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(T(t={},n,function(){return this}),t),f=s.prototype=c.prototype=Object.create(u);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,T(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=s,T(f,"constructor",s),T(s,"constructor",l),l.displayName="GeneratorFunction",T(s,o,"GeneratorFunction"),T(f),T(f,o,"Generator"),T(f,n,function(){return this}),T(f,"toString",function(){return"[object Generator]"}),(j=function(){return{w:a,m:h}})()}function T(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}T=function(e,t,r,n){if(t)o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{function a(t,r){T(e,t,function(e){return this._invoke(t,r,e)})}a("next",0),a("throw",1),a("return",2)}},T(e,t,r,n)}var E=j().m(L);function L(e,t){var r,n,o,a;return j().w(function(i){for(;;)switch(i.n){case 0:return r=Math.floor(Math.random()*e.length),n=e[r],o=Math.ceil(Math.random()*t),a=new n({level:1}),o>1&&a.upgradeCharacter(o-1),i.n=1,a;case 1:i.n=0;break;case 2:return i.a(2)}},E)}function _(e,t,r){var n=L(e,t);return new O(new Array(r).fill(null).map(function(e){return n.next().value})).characters}function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function M(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(M=function(){return!!e})()}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}function A(e,t){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},A(e,t)}var R=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=x(t),function(e,t){if(t&&("object"==G(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,M()?Reflect.construct(t,r||[],x(e).constructor):t.apply(e,r))}(this,t,[n])).level=e.level,r.attack=e.attack||22,r.defence=e.defence||12,r.moveRange=2,r.attackRange=2,r.type="bowman",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&A(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(n);function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function B(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(B=function(){return!!e})()}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}function F(e,t){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},F(e,t)}var N=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=D(t),function(e,t){if(t&&("object"==I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,B()?Reflect.construct(t,r||[],D(e).constructor):t.apply(e,r))}(this,t,[n])).level=e.level,r.attack=e.attack||25,r.defence=e.defence||10,r.moveRange=4,r.attackRange=1,r.type="swordsman",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(n);function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function H(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(H=function(){return!!e})()}function q(e){return q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},q(e)}function U(e,t){return U=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},U(e,t)}var W=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=q(t),function(e,t){if(t&&("object"==z(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,H()?Reflect.construct(t,r||[],q(e).constructor):t.apply(e,r))}(this,t,[n])).level=e.level,r.attack=e.attack||20,r.defence=e.defence||15,r.moveRange=1,r.attackRange=4,r.type="magician",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&U(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(n);function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function J(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(J=function(){return!!e})()}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}function K(e,t){return K=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},K(e,t)}var Q=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=V(t),function(e,t){if(t&&("object"==$(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,J()?Reflect.construct(t,r||[],V(e).constructor):t.apply(e,r))}(this,t,[n])).level=e.level,r.attack=e.attack||20,r.defence=e.defence||10,r.moveRange=1,r.attackRange=4,r.type="daemon",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&K(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(n);function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function Y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(Y=function(){return!!e})()}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}function ee(e,t){return ee=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ee(e,t)}function te(e){return te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},te(e)}function re(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(re=function(){return!!e})()}function ne(e){return ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ne(e)}function oe(e,t){return oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},oe(e,t)}var ae=[R,N,W],ie=[function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=Z(t),function(e,t){if(t&&("object"==X(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,Y()?Reflect.construct(t,r||[],Z(e).constructor):t.apply(e,r))}(this,t,[n])).level=e.level,r.attack=e.attack||22,r.defence=e.defence||12,r.moveRange=2,r.attackRange=2,r.type="vampire",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ee(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(n),function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=ne(t),function(e,t){if(t&&("object"==te(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,re()?Reflect.construct(t,r||[],ne(e).constructor):t.apply(e,r))}(this,t,[n])).level=e.level,r.attack=e.attack||25,r.defence=e.defence||10,r.moveRange=4,r.attackRange=1,r.type="undead",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&oe(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(n),Q];function ce(e){return ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(e)}function le(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?le(Object(r),!0).forEach(function(t){ue(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):le(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ue(e,t,r){return(t=pe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fe(e){return function(e){if(Array.isArray(e))return he(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return he(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?he(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function ye(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,pe(n.key),n)}}function pe(e){var t=function(e){if("object"!=ce(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ce(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ce(t)?t:t+""}var de=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentTurn=(null==t?void 0:t.currentTurn)||"player",this.selectedCharacter=(null==t?void 0:t.selectedCharacter)||null,this.nextFoeIndex=(null==t?void 0:t.nextFoeIndex)||0,this.gameLevel=(null==t?void 0:t.gameLevel)||1,this.playerTeamPositioned=(null==t?void 0:t.playerTeamPositioned)||[],this.foeTeamPositioned=(null==t?void 0:t.foeTeamPositioned)||[],this.allPositionedCharacters=(null==t?void 0:t.allPositionedCharacters)||[],this.highScores=(null==t?void 0:t.highScores)||0,this.currentScores=(null==t?void 0:t.currentScores)||0,this.gameLoaded=!1},t=[{key:"from",value:function(e){var t=e.playerTeamPositioned.map(function(e){var t=new(ae.find(function(t){return new t({level:1}).type===e.character.type}))(e.character);return new l(t,e.position)}),r=e.foeTeamPositioned.map(function(e){var t=new(ie.find(function(t){return new t({level:1}).type===e.character.type}))(e.character);return new l(t,e.position)}),n=[].concat(fe(t),fe(r));return se(se({},e),{},{playerTeamPositioned:t,foeTeamPositioned:r,allPositionedCharacters:n})}}],null&&ye(e.prototype,null),t&&ye(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),me="auto",ve="pointer",be="crosshair",ge="not-allowed";function Se(e){return Se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Se(e)}function we(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,s=Object.create(l.prototype);return Ce(s,"_invoke",function(r,n,o){var a,c,l,s=0,u=o||[],f=!1,h={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return a=t,c=0,l=e,h.n=r,i}};function y(r,n){for(c=r,l=n,t=0;!f&&s&&!o&&t<u.length;t++){var o,a=u[t],y=h.p,p=a[2];r>3?(o=p===n)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=y&&((o=r<2&&y<a[1])?(c=0,h.v=n,h.n=a[1]):y<p&&(o=r<3||a[0]>n||n>p)&&(a[4]=r,a[5]=n,h.n=p,c=0))}if(o||r>1)return i;throw f=!0,n}return function(o,u,p){if(s>1)throw TypeError("Generator is already running");for(f&&1===u&&y(u,p),c=u,l=p;(t=c<2?e:l)||!f;){a||(c?c<3?(c>1&&(h.n=-1),y(c,l)):h.n=l:h.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=h.n<0)?l:r.call(n,h))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:f}}}(r,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(Ce(t={},n,function(){return this}),t),f=s.prototype=c.prototype=Object.create(u);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,Ce(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=s,Ce(f,"constructor",s),Ce(s,"constructor",l),l.displayName="GeneratorFunction",Ce(s,o,"GeneratorFunction"),Ce(f),Ce(f,o,"Generator"),Ce(f,n,function(){return this}),Ce(f,"toString",function(){return"[object Generator]"}),(we=function(){return{w:a,m:h}})()}function Ce(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Ce=function(e,t,r,n){if(t)o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{function a(t,r){Ce(e,t,function(e){return this._invoke(t,r,e)})}a("next",0),a("throw",1),a("return",2)}},Ce(e,t,r,n)}function Pe(e,t,r,n,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,o)}function ke(e){return function(e){if(Array.isArray(e))return Oe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Oe(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Oe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function je(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ee(n.key),n)}}function Te(e,t,r){return(t=Ee(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ee(e){var t=function(e){if("object"!=Se(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Se(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Se(t)?t:t+""}var Le=function(){return e=function e(t,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Te(this,"onNewGameButtonClick",function(){var e={highScores:n.gameState.highScores};n.gameState=new de(e),n.init(),n.setHighScores(n.gameState.highScores),g.showMessage("Начинается новая игра!")}),Te(this,"onSaveGameButtonClick",function(){n.stateService.save(n.gameState),g.showMessage("Игра сохранена!")}),Te(this,"onLoadGameButtonClick",function(){try{var e=n.stateService.load();n.gameState=de.from(e),n.gameState.gameLoaded=!0,n.init(),n.gameState.gameLoaded=!1,n.setHighScores(n.gameState.highScores),g.showMessage("Игра загружена!")}catch(e){g.showError("Invalid state")}}),Te(this,"onCellClick",function(e){var t=n.gameState.allPositionedCharacters.find(function(t){return e===t.position});t&&n.gameState.playerTeamPositioned.some(function(e){return e.character===t.character})?n.selectCharacter(t):null!==n.gameState.selectedCharacter&&n.selectedCharaterMovePossibleCells.some(function(t){return t===e})?n.moveCharacter(e):null!==n.gameState.selectedCharacter&&n.selectedCharaterAttackPossibleCells.some(function(t){return t===e})?n.attackCharacter(e):null!==n.gameState.selectedCharacter?g.showError("Вы не можете сделать такой ход"):g.showError("Можно выбрать только собственных персонажей")}),Te(this,"onCellEnter",function(e){var t=n.gameState.allPositionedCharacters.find(function(t){return e===t.position});if(t){var r=n.compileTooltip(t);n.gamePlay.showCellTooltip(r,e)}n.gamePlay.setCursor(n.setCursorType(e))}),Te(this,"onCellLeave",function(e){n.gameState.allPositionedCharacters.find(function(t){return e===t.position})&&n.gamePlay.hideCellTooltip(e),null!==n.gameState.selectedCharacter&&e!==n.gameState.selectedCharacter.position&&n.gamePlay.deselectCell(e)}),this.gamePlay=t,this.stateService=r,this.selectedCharaterMovePossibleCells=[],this.selectedCharaterAttackPossibleCells=[],this.gameState=new de},t=[{key:"init",value:function(){var e,t;this.gamePlay.drawUi(S[this.gameState.gameLevel-1]),this.setHighScores(),this.setCurrentScores(),1!==this.gameState.gameLevel||this.gameState.gameLoaded?this.gameState.gameLevel>1&&!this.gameState.gameLoaded&&(e=this.gameState.playerTeamPositioned.map(function(e){return e.character}),t=_(ie,this.gameState.gameLevel,3+this.gameState.gameLevel),this.gameState.playerTeamPositioned=f("player",e,this.gamePlay.boardSize),this.gameState.foeTeamPositioned=f("foe",t,this.gamePlay.boardSize)):(e=_(ae,2,4),t=_(ie,1,3),this.gameState.playerTeamPositioned=f("player",e,this.gamePlay.boardSize),this.gameState.foeTeamPositioned=f("foe",t,this.gamePlay.boardSize)),this.gameState.allPositionedCharacters=[].concat(ke(this.gameState.playerTeamPositioned),ke(this.gameState.foeTeamPositioned)),this.gamePlay.redrawPositions(this.gameState.allPositionedCharacters),this.addCellsEnterListeners(),this.addCellsLeaveListeners(),this.addCellsClickListeners(),this.addNewGameListener(),this.addSaveGameListener(),this.addLoadGameListener()}},{key:"addNewGameListener",value:function(){this.gamePlay.addNewGameListener(this.onNewGameButtonClick)}},{key:"addSaveGameListener",value:function(){this.gamePlay.addSaveGameListener(this.onSaveGameButtonClick)}},{key:"addLoadGameListener",value:function(){this.gamePlay.addLoadGameListener(this.onLoadGameButtonClick)}},{key:"addCellsEnterListeners",value:function(){var e=this;this.gamePlay.cells.forEach(function(){e.gamePlay.addCellEnterListener(e.onCellEnter)})}},{key:"addCellsLeaveListeners",value:function(){var e=this;this.gamePlay.cells.forEach(function(){e.gamePlay.addCellLeaveListener(e.onCellLeave)})}},{key:"addCellsClickListeners",value:function(){var e=this;this.gamePlay.cells.forEach(function(){e.gamePlay.addCellClickListener(e.onCellClick)})}},{key:"compileTooltip",value:function(e){var t="🎖 ".concat(e.character.level," "),r="⚔ ".concat(e.character.attack," "),n="🛡 ".concat(e.character.defence," "),o="❤ ".concat(e.character.health);return"".concat(t,r,n,o)}},{key:"setCursorType",value:function(e){var t=this,r=this.gameState.selectedCharacter;return null!==r&&this.gameState.playerTeamPositioned.includes(r)?this.selectedCharaterMovePossibleCells.some(function(t){return t===e})?(this.gamePlay.cells.forEach(function(e,r){t.selectedCharaterMovePossibleCells.some(function(e){return e===r})&&t.gamePlay.deselectCell(r)}),this.gamePlay.selectCell(e,"green"),ve):this.selectedCharaterAttackPossibleCells.some(function(t){return t===e})?(this.gamePlay.cells.forEach(function(e,r){t.selectedCharaterAttackPossibleCells.some(function(e){return e===r})&&t.gamePlay.deselectCell(r)}),this.gamePlay.selectCell(e,"red"),be):e!==r.position&&this.gameState.playerTeamPositioned.some(function(t){return t.position===e})?ve:e===r.position?me:ge:this.gameState.allPositionedCharacters.some(function(t){return t.position===e})?ve:me}},{key:"selectCharacter",value:function(e){null!==this.gameState.selectedCharacter&&this.gamePlay.deselectCell(this.gameState.selectedCharacter.position),this.gameState.selectedCharacter=e,this.selectedCharaterMovePossibleCells=this.calcMovePossibleCellsIndexes(),this.selectedCharaterAttackPossibleCells=this.calcAttackPossibleCellsIndexes(),this.gamePlay.selectCell(e.position)}},{key:"moveCharacter",value:function(e){this.gamePlay.deselectCell(this.gameState.selectedCharacter.position),this.gameState.selectedCharacter.position=e,this.gamePlay.deselectCell(e),this.gameState.selectedCharacter=null,this.gamePlay.redrawPositions(this.gameState.allPositionedCharacters),this.nextTurn()}},{key:"attackCharacter",value:(r=we().m(function e(t){var r,n,o;return we().w(function(e){for(;;)switch(e.n){case 0:return r=this.gameState.allPositionedCharacters.find(function(e){return e.position===t}),n=this.gameState.selectedCharacter.character.attack,o=Math.max(n-r.character.defence,Math.round(.1*n)),r.character.health-=o,this.gamePlay.deselectCell(this.gameState.selectedCharacter.position),this.gameState.selectedCharacter=null,this.gamePlay.deselectCell(t),e.n=1,this.gamePlay.showDamage(t,o);case 1:if(this.handleCharacterDeath(r),this.gamePlay.redrawPositions(this.gameState.allPositionedCharacters),!this.checkEndGameActions()){e.n=2;break}return e.a(2);case 2:this.nextTurn();case 3:return e.a(2)}},e,this)}),n=function(){var e=this,t=arguments;return new Promise(function(n,o){var a=r.apply(e,t);function i(e){Pe(a,n,o,i,c,"next",e)}function c(e){Pe(a,n,o,i,c,"throw",e)}i(void 0)})},function(e){return n.apply(this,arguments)})},{key:"handleCharacterDeath",value:function(e){e.character.health<=0&&(ie.some(function(t){return e.character instanceof t})&&(this.gameState.currentScores+=50,this.setCurrentScores()),this.gameState.playerTeamPositioned=this.gameState.playerTeamPositioned.filter(function(t){return t!==e}),this.gameState.foeTeamPositioned=this.gameState.foeTeamPositioned.filter(function(t){return t!==e}),this.gameState.allPositionedCharacters=[].concat(ke(this.gameState.playerTeamPositioned),ke(this.gameState.foeTeamPositioned)))}},{key:"getCellCoordinates",value:function(e){var t=Math.ceil((e+1)/(Math.pow(this.gamePlay.boardSize,2)+1)*this.gamePlay.boardSize)-1;return{row:t,column:e-t*this.gamePlay.boardSize}}},{key:"getCellIndexFromCoordinates",value:function(e){return this.gamePlay.boardSize*e.row+e.column}},{key:"calcAttackPossibleCellsIndexes",value:function(){var e=this;if(null!==this.gameState.selectedCharacter){for(var t=this.gameState.selectedCharacter.position,r=this.gameState.selectedCharacter.character.attackRange,n=this.getCellCoordinates(t),o=[],a=0;a<this.gamePlay.cells.length;a++){var i=this.getCellCoordinates(a);i.row<=n.row+r&&i.row>=n.row-r&&i.column>=n.column-r&&i.column<=n.column+r&&o.push(a)}return o.filter(function(r){if(("player"===e.gameState.currentTurn?e.gameState.foeTeamPositioned:e.gameState.playerTeamPositioned).find(function(e){return e.position===r&&t!==r}))return!0})}}},{key:"calcMovePossibleCellsIndexes",value:function(){var e=this;if(null!==this.gameState.selectedCharacter){for(var t=this.gamePlay.boardSize,r=this.gameState.selectedCharacter.position,n=this.gameState.selectedCharacter.character.moveRange,o=this.getCellCoordinates(r).row,a=[],i=-n;i<=n;i++)if(0!==i){var c=r+i*t;a.push(c)}for(var l=-n;l<=n;l++)if(0!==l){var s=r+l;s>=o*t&&s<o*t+t&&a.push(s)}for(var u=-n;u<=n;u++)if(0!==u){var f=-1===Math.sign(u)?r-t*Math.abs(u)+u:r+t*Math.abs(u)+u;f>=(o+u)*t&&f<(o+u)*t+t&&a.push(f)}for(var h=-n;h<=n;h++)if(0!==h){var y=-1===Math.sign(h)?r-t*Math.abs(h)-h:r+t*Math.abs(h)-h;y>=(o+h)*t&&y<(o+h)*t+t&&a.push(y)}return a.filter(function(r){var n=e.gameState.allPositionedCharacters.find(function(e){return r===e.position});if(r>=0&&r<Math.pow(t,2)&&!n)return!0})}}},{key:"blockBoard",value:function(){var e=document.querySelector(".board"),t=e.cloneNode(!0);e.replaceWith(t)}},{key:"blockWindow",value:function(e){var t=document.createElement("div");t.classList.add("blocking-wrapper"),document.body.append(t);var r=document.createElement("span");r.classList.add("blocking-wrapper_clocks"),r.textContent="🕑",t.append(r),setTimeout(function(){return t.remove()},e)}},{key:"calculateFoeTurn",value:function(){var e=this;this.gameState.selectedCharacter=this.gameState.foeTeamPositioned[this.gameState.nextFoeIndex],this.selectCharacter(this.gameState.selectedCharacter),this.blockWindow(1500),setTimeout(function(){e.activateFoe()},1e3)}},{key:"calculateLevelUpAfterVictory",value:function(){this.gameState.playerTeamPositioned.forEach(function(e){e.character.level<4&&e.character.upgradeCharacter(1)})}},{key:"activateFoe",value:function(){var e=this,t=this.gameState.playerTeamPositioned.map(function(t){return{coordinates:e.getCellCoordinates(t.position),position:t.position}}),r=this.getCellCoordinates(this.gameState.selectedCharacter.position);if(this.selectedCharaterAttackPossibleCells.length>0){var n=this.gameState.playerTeamPositioned.filter(function(t){return e.selectedCharaterAttackPossibleCells.includes(t.position)}).sort(function(e,t){return e.character.health-t.character.health})[0];this.attackCharacter(n.position)}else{var o=t.map(function(e){return{distanceToPlayerCharacter:h(e.coordinates,r),playerCharacterPosition:e}}).sort(function(e,t){return e.distanceToPlayerCharacter-t.distanceToPlayerCharacter})[0],a=this.selectedCharaterMovePossibleCells.map(function(t){var r=e.getCellCoordinates(t);return{distanceToPlayerCharacter:h(o.playerCharacterPosition.coordinates,r),possibleMoveCell:t}}).sort(function(e,t){return e.distanceToPlayerCharacter-t.distanceToPlayerCharacter})[0];this.moveCharacter(a.possibleMoveCell)}}},{key:"startNewLevel",value:function(){this.calculateLevelUpAfterVictory(),this.gameState.gameLevel+=1,this.init(),this.nextTurn()}},{key:"runEndGameActions",value:function(e){this.blockBoard(),this.gameState.highScores=Math.max(this.gameState.highScores,this.gameState.currentScores),this.gameState.currentScores=0,this.setHighScores(),g.showMessage("win"===e?"Вы победили!":"Вы проиграли!")}},{key:"setHighScores",value:function(){document.querySelector(".high-scores").textContent=this.gameState.highScores}},{key:"setCurrentScores",value:function(){document.querySelector(".current-scores").textContent=this.gameState.currentScores}},{key:"checkEndGameActions",value:function(){return 0===this.gameState.playerTeamPositioned.length?(this.runEndGameActions("lose"),!0):0===this.gameState.foeTeamPositioned.length&&4===this.gameState.gameLevel?(this.runEndGameActions("win"),!0):void 0}},{key:"nextTurn",value:function(){this.gameState.currentTurn="player"===this.gameState.currentTurn?"foe":"player","foe"===this.gameState.currentTurn&&this.gameState.foeTeamPositioned.length>0?(this.gameState.nextFoeIndex=(this.gameState.nextFoeIndex+1)%this.gameState.foeTeamPositioned.length,this.calculateFoeTurn()):0===this.gameState.foeTeamPositioned.length&&this.startNewLevel()}}],t&&je(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r,n}();function _e(e){return _e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_e(e)}function Ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Me(n.key),n)}}function Me(e){var t=function(e){if("object"!=_e(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=_e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==_e(t)?t:t+""}var xe=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storage=t},t=[{key:"save",value:function(e){this.storage.setItem("state",JSON.stringify(e))}},{key:"load",value:function(){try{var e=this.storage.getItem("state");if(null===e)throw new Error("Invalid state");return JSON.parse(e)}catch(e){g.showError(e.message)}}}],t&&Ge(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),Ae=new g;Ae.bindToDOM(document.querySelector("#game-container")),new Le(Ae,new xe(localStorage)).init()}();