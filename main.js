/*! For license information please see main.js.LICENSE.txt */
!function(){"use strict";function e(e,t){var r=Math.pow(t,2);return 0===e?"top-left":e===t-1?"top-right":e===r-t?"bottom-left":e===r-1?"bottom-right":e<t-1?"top":e%t===0?"left":(e+1)%t===0?"right":e<r&&e>r-t?"bottom":"center"}function t(e){return e<15?"critical":e<50?"normal":"high"}function r(e,t){var r=e.row,n=e.column,o=t.row,a=t.column;return Number(Math.sqrt(Math.pow(o-r,2)+Math.pow(a-n,2)).toFixed(2))}function n(e,t){var r=Math.ceil((e+1)/(Math.pow(t,2)+1)*t)-1;return{row:r,column:e-r*t}}function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function a(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=i(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,c=!0,l=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return c=e.done,e},e:function(e){l=!0,a=e},f:function(){try{c||null==r.return||r.return()}finally{if(l)throw a}}}}function i(e,t){if(e){if("string"==typeof e)return c(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function s(e){var t=function(e){if("object"!=o(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==o(t)?t:t+""}var u=function(){return r=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.boardSize=8,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.newGameListener=null,this.saveGameListener=null,this.loadGameListener=null},n=[{key:"bindToDOM",value:function(e){if(!(e instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=e}},{key:"drawUi",value:function(t){var r=this;this.checkBinding(),this.container.innerHTML='\n      <div class="controls">\n        <button data-id="action-restart" class="btn">New Game</button>\n        <button data-id="action-save" class="btn">Save Game</button>\n        <button data-id="action-load" class="btn">Load Game</button>\n      </div>\n      <div class="scores-wrapper">\n        <span class="high-scores-desc">High scores:</span>\n        <span class="high-scores">0</span>\n        <span class="current-scores-desc">Current scores:</span>\n        <span class="current-scores">0</span>\n      </div>\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.newGameEl=this.container.querySelector("[data-id=action-restart]"),this.saveGameEl=this.container.querySelector("[data-id=action-save]"),this.loadGameEl=this.container.querySelector("[data-id=action-load]"),this.newGameEl.addEventListener("click",function(e){return r.onNewGameClick(e)}),this.saveGameEl.addEventListener("click",function(e){return r.onSaveGameClick(e)}),this.loadGameEl.addEventListener("click",function(e){return r.onLoadGameClick(e)}),this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(var n=0;n<Math.pow(this.boardSize,2);n+=1){var o=document.createElement("div");o.classList.add("cell","map-tile","map-tile-".concat(e(n,this.boardSize))),o.addEventListener("mouseenter",function(e){return r.onCellEnter(e)}),o.addEventListener("mouseleave",function(e){return r.onCellLeave(e)}),o.addEventListener("click",function(e){return r.onCellClick(e)}),this.boardEl.appendChild(o)}this.cells=Array.from(this.boardEl.children)}},{key:"redrawPositions",value:function(e){var r,n=a(this.cells);try{for(n.s();!(r=n.n()).done;){var o=r.value;o.innerHTML="",o.title=""}}catch(e){n.e(e)}finally{n.f()}var i,c=a(e);try{for(c.s();!(i=c.n()).done;){var l=i.value,s=this.boardEl.children[l.position],u=document.createElement("div");u.classList.add("character",l.character.type);var f=document.createElement("div");f.classList.add("health-level");var h=document.createElement("div"),y=t(l.character.health);h.classList.add("health-level-indicator","health-level-indicator-".concat(y)),h.style.width="".concat(l.character.health,"%"),f.appendChild(h),u.appendChild(f),s.appendChild(u)}}catch(e){c.e(e)}finally{c.f()}}},{key:"addCellEnterListener",value:function(e){this.cellEnterListeners.push(e)}},{key:"addCellLeaveListener",value:function(e){this.cellLeaveListeners.push(e)}},{key:"addCellClickListener",value:function(e){this.cellClickListeners.push(e)}},{key:"addNewGameListener",value:function(e){this.newGameListener=e}},{key:"addSaveGameListener",value:function(e){this.saveGameListener=e}},{key:"addLoadGameListener",value:function(e){this.loadGameListener=e}},{key:"onCellEnter",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.cellEnterListeners[t].call(null,t)}},{key:"onCellLeave",value:function(e){e.preventDefault();var t=this.cells.indexOf(e.currentTarget);this.cellLeaveListeners[t].call(null,t)}},{key:"onCellClick",value:function(e){var t=this.cells.indexOf(e.currentTarget);this.cellClickListeners[t].call(null,t)}},{key:"onNewGameClick",value:function(e){e.preventDefault(),this.newGameListener.call(null)}},{key:"onSaveGameClick",value:function(e){e.preventDefault(),this.saveGameListener.call(null)}},{key:"onLoadGameClick",value:function(e){e.preventDefault(),this.loadGameListener.call(null)}},{key:"selectCell",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(e),this.cells[e].classList.add("selected","selected-".concat(t))}},{key:"deselectCell",value:function(e){var t,r=this.cells[e];(t=r.classList).remove.apply(t,function(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(Array.from(r.classList).filter(function(e){return e.startsWith("selected")})))}},{key:"showCellTooltip",value:function(e,t){this.cells[t].title=e}},{key:"hideCellTooltip",value:function(e){this.cells[e].title=""}},{key:"showDamage",value:function(e,t){var r=this;return new Promise(function(n){var o=r.cells[e],a=document.createElement("span");a.textContent=t,a.classList.add("damage"),o.appendChild(a),a.addEventListener("animationend",function(){o.removeChild(a),n()})})}},{key:"setCursor",value:function(e){this.boardEl.style.cursor=e}},{key:"checkBinding",value:function(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}}],o=[{key:"showError",value:function(e){alert(e)}},{key:"showMessage",value:function(e){alert(e)}}],n&&l(r.prototype,n),o&&l(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o}(),f=["prairie","desert","arctic","mountain"];function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function y(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,p(n.key),n)}}function p(e){var t=function(e){if("object"!=h(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=h(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==h(t)?t:t+""}var d=function(){return e=function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"Character"===(this instanceof e?this.constructor:void 0).name)throw new Error("Персонаж должен создаваться из дочернего класса!");this.level=t.level,this.attack=t.attack||0,this.defence=t.defence||0,this.health=50,this.type="generic"},(t=[{key:"upgradeCharacter",value:function(e){for(var t=0;t<e;t++)this.level+=1,this.health=this.health<20?this.health+80:100,this.attack=Math.max(this.attack,Math.round(this.attack*(20+this.health)/100)),this.defence=Math.max(this.defence,Math.round(this.defence*(10+this.health)/100))}}])&&y(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,g(n.key),n)}}function b(e,t,r){return t&&v(e.prototype,t),r&&v(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function g(e){var t=function(e){if("object"!=m(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==m(t)?t:t+""}var S=b(function e(t,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof d))throw new Error("character must be instance of Character or its children");if("number"!=typeof r)throw new Error("position must be a number");this.character=t,this.position=r});function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}function P(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,C(n.key),n)}}function C(e){var t=function(e){if("object"!=w(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==w(t)?t:t+""}var O=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.characters=t},(t=[{key:"calcPositionedCharacters",value:function(e,t){var r=Math.pow(t,2),n=[];if("player"===e)for(var o=0;o<r;o++)0!==o&&o%t!==0&&(o-1)%t!=0||n.push(o);else for(var a=0;a<r;a++)(a+1)%t!==0&&(a+2)%t!==0||n.push(a);return this.characters.map(function(e){var t=Math.floor(Math.random()*n.length),r=n[t];return n.splice(t,1),new S(e,r)})}}])&&P(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function k(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,s=Object.create(l.prototype);return j(s,"_invoke",function(r,n,o){var a,c,l,s=0,u=o||[],f=!1,h={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return a=t,c=0,l=e,h.n=r,i}};function y(r,n){for(c=r,l=n,t=0;!f&&s&&!o&&t<u.length;t++){var o,a=u[t],y=h.p,p=a[2];r>3?(o=p===n)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=y&&((o=r<2&&y<a[1])?(c=0,h.v=n,h.n=a[1]):y<p&&(o=r<3||a[0]>n||n>p)&&(a[4]=r,a[5]=n,h.n=p,c=0))}if(o||r>1)return i;throw f=!0,n}return function(o,u,p){if(s>1)throw TypeError("Generator is already running");for(f&&1===u&&y(u,p),c=u,l=p;(t=c<2?e:l)||!f;){a||(c?c<3?(c>1&&(h.n=-1),y(c,l)):h.n=l:h.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=h.n<0)?l:r.call(n,h))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:f}}}(r,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(j(t={},n,function(){return this}),t),f=s.prototype=c.prototype=Object.create(u);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,j(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=s,j(f,"constructor",s),j(s,"constructor",l),l.displayName="GeneratorFunction",j(s,o,"GeneratorFunction"),j(f),j(f,o,"Generator"),j(f,n,function(){return this}),j(f,"toString",function(){return"[object Generator]"}),(k=function(){return{w:a,m:h}})()}function j(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}j=function(e,t,r,n){if(t)o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{function a(t,r){j(e,t,function(e){return this._invoke(t,r,e)})}a("next",0),a("throw",1),a("return",2)}},j(e,t,r,n)}var T=k().m(E);function E(e,t){var r,n,o,a;return k().w(function(i){for(;;)switch(i.n){case 0:return r=Math.floor(Math.random()*e.length),n=e[r],o=Math.ceil(Math.random()*t),a=new n({level:1}),o>1&&a.upgradeCharacter(o-1),i.n=1,a;case 1:i.n=0;break;case 2:return i.a(2)}},T)}function L(e,t,r){var n=E(e,t);return new O(new Array(r).fill(null).map(function(e){return n.next().value}))}function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function G(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(G=function(){return!!e})()}function M(e){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},M(e)}function x(e,t){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},x(e,t)}var A=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=M(t),function(e,t){if(t&&("object"==_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,G()?Reflect.construct(t,r||[],M(e).constructor):t.apply(e,r))}(this,t,[d])).level=e.level,r.attack=e.attack||22,r.defence=e.defence||12,r.moveRange=2,r.attackRange=2,r.type="bowman",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&x(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(d);function R(e){return R="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},R(e)}function I(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(I=function(){return!!e})()}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}function B(e,t){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},B(e,t)}var N=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=D(t),function(e,t){if(t&&("object"==R(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,I()?Reflect.construct(t,r||[],D(e).constructor):t.apply(e,r))}(this,t,[d])).level=e.level,r.attack=e.attack||25,r.defence=e.defence||10,r.moveRange=4,r.attackRange=1,r.type="swordsman",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(d);function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(z=function(){return!!e})()}function H(e){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},H(e)}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q(e,t)}var U=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=H(t),function(e,t){if(t&&("object"==F(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,z()?Reflect.construct(t,r||[],H(e).constructor):t.apply(e,r))}(this,t,[d])).level=e.level,r.attack=e.attack||20,r.defence=e.defence||15,r.moveRange=1,r.attackRange=4,r.type="magician",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(d);function $(e){return $="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$(e)}function J(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(J=function(){return!!e})()}function V(e){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},V(e)}function W(e,t){return W=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},W(e,t)}var K=function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=V(t),function(e,t){if(t&&("object"==$(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,J()?Reflect.construct(t,r||[],V(e).constructor):t.apply(e,r))}(this,t,[d])).level=e.level,r.attack=e.attack||20,r.defence=e.defence||10,r.moveRange=1,r.attackRange=4,r.type="daemon",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&W(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(d);function Q(e){return Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(e)}function X(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(X=function(){return!!e})()}function Y(e){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Y(e)}function Z(e,t){return Z=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Z(e,t)}function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(te=function(){return!!e})()}function re(e){return re=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},re(e)}function ne(e,t){return ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ne(e,t)}var oe=[A,N,U],ae=[function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=Y(t),function(e,t){if(t&&("object"==Q(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,X()?Reflect.construct(t,r||[],Y(e).constructor):t.apply(e,r))}(this,t,[d])).level=e.level,r.attack=e.attack||22,r.defence=e.defence||12,r.moveRange=2,r.attackRange=2,r.type="vampire",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Z(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(d),function(e){function t(e){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=function(e,t,r){return t=re(t),function(e,t){if(t&&("object"==ee(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,te()?Reflect.construct(t,r||[],re(e).constructor):t.apply(e,r))}(this,t,[d])).level=e.level,r.attack=e.attack||25,r.defence=e.defence||10,r.moveRange=4,r.attackRange=1,r.type="undead",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ne(e,t)}(t,e),r=t,Object.defineProperty(r,"prototype",{writable:!1}),r;var r}(d),K];function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function le(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(r),!0).forEach(function(t){se(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ce(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function se(e,t,r){return(t=ye(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ue(e){return function(e){if(Array.isArray(e))return fe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return fe(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?fe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function he(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,ye(n.key),n)}}function ye(e){var t=function(e){if("object"!=ie(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ie(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ie(t)?t:t+""}var pe=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentTurn=(null==t?void 0:t.currentTurn)||"player",this.selectedCharacter=(null==t?void 0:t.selectedCharacter)||null,this.nextFoeIndex=(null==t?void 0:t.nextFoeIndex)||0,this.gameLevel=(null==t?void 0:t.gameLevel)||1,this.playerTeamPositioned=(null==t?void 0:t.playerTeamPositioned)||[],this.foeTeamPositioned=(null==t?void 0:t.foeTeamPositioned)||[],this.allPositionedCharacters=(null==t?void 0:t.allPositionedCharacters)||[],this.highScores=(null==t?void 0:t.highScores)||0,this.currentScores=(null==t?void 0:t.currentScores)||0,this.gameLoaded=!1},r=[{key:"from",value:function(e){var t=e.playerTeamPositioned.map(function(e){var t=new(oe.find(function(t){return new t({level:1}).type===e.character.type}))(e.character);return new S(t,e.position)}),r=e.foeTeamPositioned.map(function(e){var t=new(ae.find(function(t){return new t({level:1}).type===e.character.type}))(e.character);return new S(t,e.position)}),n=[].concat(ue(t),ue(r));return le(le({},e),{},{playerTeamPositioned:t,foeTeamPositioned:r,allPositionedCharacters:n})}}],(t=[{key:"setHighScores",value:function(){document.querySelector(".high-scores").textContent=this.highScores}},{key:"setCurrentScores",value:function(){document.querySelector(".current-scores").textContent=this.currentScores}},{key:"runEndGameActions",value:function(e){var t,r;r=(t=document.querySelector(".board")).cloneNode(!0),t.replaceWith(r),this.highScores=Math.max(this.highScores,this.currentScores),this.currentScores=0,this.setHighScores(),u.showMessage("win"===e?"Вы победили!":"Вы проиграли!")}},{key:"checkEndGameActions",value:function(){return 0===this.playerTeamPositioned.length?(this.runEndGameActions("lose"),!0):0===this.foeTeamPositioned.length&&4===this.gameLevel?(this.runEndGameActions("win"),!0):void 0}}])&&he(e.prototype,t),r&&he(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,r}(),de="auto",me="pointer",ve="crosshair",be="not-allowed";function ge(e){return ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ge(e)}function Se(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var l=n&&n.prototype instanceof c?n:c,s=Object.create(l.prototype);return we(s,"_invoke",function(r,n,o){var a,c,l,s=0,u=o||[],f=!1,h={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return a=t,c=0,l=e,h.n=r,i}};function y(r,n){for(c=r,l=n,t=0;!f&&s&&!o&&t<u.length;t++){var o,a=u[t],y=h.p,p=a[2];r>3?(o=p===n)&&(l=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=e):a[0]<=y&&((o=r<2&&y<a[1])?(c=0,h.v=n,h.n=a[1]):y<p&&(o=r<3||a[0]>n||n>p)&&(a[4]=r,a[5]=n,h.n=p,c=0))}if(o||r>1)return i;throw f=!0,n}return function(o,u,p){if(s>1)throw TypeError("Generator is already running");for(f&&1===u&&y(u,p),c=u,l=p;(t=c<2?e:l)||!f;){a||(c?c<3?(c>1&&(h.n=-1),y(c,l)):h.n=l:h.v=l);try{if(s=2,a){if(c||(o="next"),t=a[o]){if(!(t=t.call(a,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,c<2&&(c=0)}else 1===c&&(t=a.return)&&t.call(a),c<2&&(l=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=e}else if((t=(f=h.n<0)?l:r.call(n,h))!==i)break}catch(t){a=e,c=1,l=t}finally{s=1}}return{value:t,done:f}}}(r,o,a),!0),s}var i={};function c(){}function l(){}function s(){}t=Object.getPrototypeOf;var u=[][n]?t(t([][n]())):(we(t={},n,function(){return this}),t),f=s.prototype=c.prototype=Object.create(u);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,we(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return l.prototype=s,we(f,"constructor",s),we(s,"constructor",l),l.displayName="GeneratorFunction",we(s,o,"GeneratorFunction"),we(f),we(f,o,"Generator"),we(f,n,function(){return this}),we(f,"toString",function(){return"[object Generator]"}),(Se=function(){return{w:a,m:h}})()}function we(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}we=function(e,t,r,n){if(t)o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{function a(t,r){we(e,t,function(e){return this._invoke(t,r,e)})}a("next",0),a("throw",1),a("return",2)}},we(e,t,r,n)}function Pe(e,t,r,n,o,a,i){try{var c=e[a](i),l=c.value}catch(e){return void r(e)}c.done?t(l):Promise.resolve(l).then(n,o)}function Ce(e){return function(e){if(Array.isArray(e))return Oe(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Oe(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Oe(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Te(n.key),n)}}function je(e,t,r){return(t=Te(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Te(e){var t=function(e){if("object"!=ge(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=ge(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==ge(t)?t:t+""}var Ee=function(){return e=function e(t,r){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),je(this,"onNewGameButtonClick",function(){var e={highScores:n.gameState.highScores};n.gameState=new pe(e),n.init(),n.gameState.setHighScores(n.gameState.highScores),u.showMessage("Начинается новая игра!")}),je(this,"onSaveGameButtonClick",function(){n.stateService.save(n.gameState),u.showMessage("Игра сохранена!")}),je(this,"onLoadGameButtonClick",function(){try{var e=n.stateService.load();n.gameState=new pe(pe.from(e)),n.gameState.gameLoaded=!0,n.init(),n.gameState.gameLoaded=!1,n.gameState.setHighScores(n.gameState.highScores),u.showMessage("Игра загружена!")}catch(e){u.showError("Invalid state")}}),je(this,"onCellClick",function(e){var t=n.gameState.allPositionedCharacters.find(function(t){return e===t.position});t&&n.gameState.playerTeamPositioned.some(function(e){return e.character===t.character})?n.selectCharacter(t):null!==n.gameState.selectedCharacter&&n.selectedCharaterMovePossibleCells.some(function(t){return t===e})?n.moveCharacter(e):null!==n.gameState.selectedCharacter&&n.selectedCharaterAttackPossibleCells.some(function(t){return t===e})?n.attackCharacter(e):null!==n.gameState.selectedCharacter?u.showError("Вы не можете сделать такой ход"):u.showError("Можно выбрать только собственных персонажей")}),je(this,"onCellEnter",function(e){var t=n.gameState.allPositionedCharacters.find(function(t){return e===t.position});if(t){var r=function(e){var t="🎖 ".concat(e.character.level," "),r="⚔ ".concat(e.character.attack," "),n="🛡 ".concat(e.character.defence," "),o="❤ ".concat(e.character.health);return"".concat(t,r,n,o)}(t);n.gamePlay.showCellTooltip(r,e)}n.gamePlay.setCursor(n.setCursorType(e))}),je(this,"onCellLeave",function(e){n.gameState.allPositionedCharacters.find(function(t){return e===t.position})&&n.gamePlay.hideCellTooltip(e),null!==n.gameState.selectedCharacter&&e!==n.gameState.selectedCharacter.position&&n.gamePlay.deselectCell(e)}),this.gamePlay=t,this.stateService=r,this.selectedCharaterMovePossibleCells=[],this.selectedCharaterAttackPossibleCells=[],this.gameState=new pe},t=[{key:"init",value:function(){var e,t;this.gamePlay.drawUi(f[this.gameState.gameLevel-1]),this.gameState.setHighScores(),this.gameState.setCurrentScores(),1!==this.gameState.gameLevel||this.gameState.gameLoaded?this.gameState.gameLevel>1&&!this.gameState.gameLoaded&&(e=new O(this.gameState.playerTeamPositioned.map(function(e){return e.character})),t=L(ae,this.gameState.gameLevel,3+this.gameState.gameLevel),this.gameState.playerTeamPositioned=e.calcPositionedCharacters("player",this.gamePlay.boardSize),this.gameState.foeTeamPositioned=t.calcPositionedCharacters("foe",this.gamePlay.boardSize)):(e=L(oe,2,4),t=L(ae,1,3),this.gameState.playerTeamPositioned=e.calcPositionedCharacters("player",this.gamePlay.boardSize),this.gameState.foeTeamPositioned=t.calcPositionedCharacters("foe",this.gamePlay.boardSize)),this.gameState.allPositionedCharacters=[].concat(Ce(this.gameState.playerTeamPositioned),Ce(this.gameState.foeTeamPositioned)),this.gamePlay.redrawPositions(this.gameState.allPositionedCharacters),this.addCellsEnterListeners(),this.addCellsLeaveListeners(),this.addCellsClickListeners(),this.addNewGameListener(),this.addSaveGameListener(),this.addLoadGameListener()}},{key:"addNewGameListener",value:function(){this.gamePlay.addNewGameListener(this.onNewGameButtonClick)}},{key:"addSaveGameListener",value:function(){this.gamePlay.addSaveGameListener(this.onSaveGameButtonClick)}},{key:"addLoadGameListener",value:function(){this.gamePlay.addLoadGameListener(this.onLoadGameButtonClick)}},{key:"addCellsEnterListeners",value:function(){var e=this;this.gamePlay.cells.forEach(function(){e.gamePlay.addCellEnterListener(e.onCellEnter)})}},{key:"addCellsLeaveListeners",value:function(){var e=this;this.gamePlay.cells.forEach(function(){e.gamePlay.addCellLeaveListener(e.onCellLeave)})}},{key:"addCellsClickListeners",value:function(){var e=this;this.gamePlay.cells.forEach(function(){e.gamePlay.addCellClickListener(e.onCellClick)})}},{key:"setCursorType",value:function(e){var t=this,r=this.gameState.selectedCharacter;return null!==r&&this.gameState.playerTeamPositioned.includes(r)?this.selectedCharaterMovePossibleCells.some(function(t){return t===e})?(this.gamePlay.cells.forEach(function(e,r){t.selectedCharaterMovePossibleCells.some(function(e){return e===r})&&t.gamePlay.deselectCell(r)}),this.gamePlay.selectCell(e,"green"),me):this.selectedCharaterAttackPossibleCells.some(function(t){return t===e})?(this.gamePlay.cells.forEach(function(e,r){t.selectedCharaterAttackPossibleCells.some(function(e){return e===r})&&t.gamePlay.deselectCell(r)}),this.gamePlay.selectCell(e,"red"),ve):e!==r.position&&this.gameState.playerTeamPositioned.some(function(t){return t.position===e})?me:e===r.position?de:be:this.gameState.allPositionedCharacters.some(function(t){return t.position===e})?me:de}},{key:"selectCharacter",value:function(e){null!==this.gameState.selectedCharacter&&this.gamePlay.deselectCell(this.gameState.selectedCharacter.position),this.gameState.selectedCharacter=e,this.selectedCharaterMovePossibleCells=this.calcMovePossibleCellsIndexes(),this.selectedCharaterAttackPossibleCells=this.calcAttackPossibleCellsIndexes(),this.gamePlay.selectCell(e.position)}},{key:"moveCharacter",value:function(e){this.gamePlay.deselectCell(this.gameState.selectedCharacter.position),this.gameState.selectedCharacter.position=e,this.gamePlay.deselectCell(e),this.gameState.selectedCharacter=null,this.gamePlay.redrawPositions(this.gameState.allPositionedCharacters),this.nextTurn()}},{key:"attackCharacter",value:(o=Se().m(function e(t){var r,n,o;return Se().w(function(e){for(;;)switch(e.n){case 0:return r=this.gameState.allPositionedCharacters.find(function(e){return e.position===t}),n=this.gameState.selectedCharacter.character.attack,o=Math.max(n-r.character.defence,Math.round(.1*n)),r.character.health-=o,this.gamePlay.deselectCell(this.gameState.selectedCharacter.position),this.gameState.selectedCharacter=null,this.gamePlay.deselectCell(t),e.n=1,this.gamePlay.showDamage(t,o);case 1:if(this.handleCharacterDeath(r),this.gamePlay.redrawPositions(this.gameState.allPositionedCharacters),!this.gameState.checkEndGameActions()){e.n=2;break}return e.a(2);case 2:this.nextTurn();case 3:return e.a(2)}},e,this)}),a=function(){var e=this,t=arguments;return new Promise(function(r,n){var a=o.apply(e,t);function i(e){Pe(a,r,n,i,c,"next",e)}function c(e){Pe(a,r,n,i,c,"throw",e)}i(void 0)})},function(e){return a.apply(this,arguments)})},{key:"handleCharacterDeath",value:function(e){e.character.health<=0&&(ae.some(function(t){return e.character instanceof t})&&(this.gameState.currentScores+=50,this.gameState.setCurrentScores()),this.gameState.playerTeamPositioned=this.gameState.playerTeamPositioned.filter(function(t){return t!==e}),this.gameState.foeTeamPositioned=this.gameState.foeTeamPositioned.filter(function(t){return t!==e}),this.gameState.allPositionedCharacters=[].concat(Ce(this.gameState.playerTeamPositioned),Ce(this.gameState.foeTeamPositioned)))}},{key:"calcAttackPossibleCellsIndexes",value:function(){var e=this;if(null!==this.gameState.selectedCharacter){for(var t=this.gameState.selectedCharacter.position,r=this.gameState.selectedCharacter.character.attackRange,o=n(t,this.gamePlay.boardSize),a=[],i=0;i<this.gamePlay.cells.length;i++){var c=n(i,this.gamePlay.boardSize);c.row<=o.row+r&&c.row>=o.row-r&&c.column>=o.column-r&&c.column<=o.column+r&&a.push(i)}return a.filter(function(r){if(("player"===e.gameState.currentTurn?e.gameState.foeTeamPositioned:e.gameState.playerTeamPositioned).find(function(e){return e.position===r&&t!==r}))return!0})}}},{key:"calcMovePossibleCellsIndexes",value:function(){var e=this;if(null!==this.gameState.selectedCharacter){for(var t=this.gamePlay.boardSize,r=this.gameState.selectedCharacter.position,o=this.gameState.selectedCharacter.character.moveRange,a=n(r,this.gamePlay.boardSize).row,i=[],c=-o;c<=o;c++)if(0!==c){var l=r+c*t;i.push(l)}for(var s=-o;s<=o;s++)if(0!==s){var u=r+s;u>=a*t&&u<a*t+t&&i.push(u)}for(var f=-o;f<=o;f++)if(0!==f){var h=-1===Math.sign(f)?r-t*Math.abs(f)+f:r+t*Math.abs(f)+f;h>=(a+f)*t&&h<(a+f)*t+t&&i.push(h)}for(var y=-o;y<=o;y++)if(0!==y){var p=-1===Math.sign(y)?r-t*Math.abs(y)-y:r+t*Math.abs(y)-y;p>=(a+y)*t&&p<(a+y)*t+t&&i.push(p)}return i.filter(function(r){var n=e.gameState.allPositionedCharacters.find(function(e){return r===e.position});if(r>=0&&r<Math.pow(t,2)&&!n)return!0})}}},{key:"calculateFoeTurn",value:function(){var e=this;this.gameState.selectedCharacter=this.gameState.foeTeamPositioned[this.gameState.nextFoeIndex],this.selectCharacter(this.gameState.selectedCharacter),function(){var e=document.createElement("div");e.classList.add("blocking-wrapper"),document.body.append(e);var t=document.createElement("span");t.classList.add("blocking-wrapper_clocks"),t.textContent="🕑",e.append(t),setTimeout(function(){return e.remove()},1500)}(),setTimeout(function(){e.activateFoe()},1e3)}},{key:"calculateLevelUpAfterVictory",value:function(){this.gameState.playerTeamPositioned.forEach(function(e){e.character.level<4&&e.character.upgradeCharacter(1)})}},{key:"activateFoe",value:function(){var e=this,t=this.gameState.playerTeamPositioned.map(function(t){return{coordinates:n(t.position,e.gamePlay.boardSize),position:t.position}}),o=n(this.gameState.selectedCharacter.position,this.gamePlay.boardSize);if(this.selectedCharaterAttackPossibleCells.length>0){var a=this.gameState.playerTeamPositioned.filter(function(t){return e.selectedCharaterAttackPossibleCells.includes(t.position)}).sort(function(e,t){return e.character.health-t.character.health})[0];this.attackCharacter(a.position)}else{var i=t.map(function(e){return{distanceToPlayerCharacter:r(e.coordinates,o),playerCharacterPosition:e}}).sort(function(e,t){return e.distanceToPlayerCharacter-t.distanceToPlayerCharacter})[0],c=this.selectedCharaterMovePossibleCells.map(function(t){var o=n(t,e.gamePlay.boardSize);return{distanceToPlayerCharacter:r(i.playerCharacterPosition.coordinates,o),possibleMoveCell:t}}).sort(function(e,t){return e.distanceToPlayerCharacter-t.distanceToPlayerCharacter})[0];this.moveCharacter(c.possibleMoveCell)}}},{key:"startNewLevel",value:function(){this.calculateLevelUpAfterVictory(),this.gameState.gameLevel+=1,this.init(),this.nextTurn()}},{key:"nextTurn",value:function(){this.gameState.currentTurn="player"===this.gameState.currentTurn?"foe":"player","foe"===this.gameState.currentTurn&&this.gameState.foeTeamPositioned.length>0?(this.gameState.nextFoeIndex=(this.gameState.nextFoeIndex+1)%this.gameState.foeTeamPositioned.length,this.calculateFoeTurn()):0===this.gameState.foeTeamPositioned.length&&this.startNewLevel()}}],t&&ke(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,o,a}();function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function _e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,Ge(n.key),n)}}function Ge(e){var t=function(e){if("object"!=Le(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var r=t.call(e,"string");if("object"!=Le(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Le(t)?t:t+""}var Me=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storage=t},t=[{key:"save",value:function(e){this.storage.setItem("state",JSON.stringify(e))}},{key:"load",value:function(){try{var e=this.storage.getItem("state");if(null===e)throw new Error("Invalid state");return JSON.parse(e)}catch(e){u.showError(e.message)}}}],t&&_e(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}(),xe=new u;xe.bindToDOM(document.querySelector("#game-container")),new Ee(xe,new Me(localStorage)).init()}();